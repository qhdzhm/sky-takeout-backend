# Sky Takeout é˜¿é‡Œäº‘éƒ¨ç½²è¯´æ˜

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### å‰ææ¡ä»¶

1. **é˜¿é‡Œäº‘ECSæœåŠ¡å™¨**
   - å·²è´­ä¹°å¹¶è¿è¡Œä¸­çš„ECSå®ä¾‹
   - æ“ä½œç³»ç»Ÿ: CentOS 7+ æˆ– Ubuntu 18.04+
   - å†…å­˜: è‡³å°‘2GB RAM
   - ç¡¬ç›˜: è‡³å°‘20GBå¯ç”¨ç©ºé—´

2. **æœ¬åœ°ç¯å¢ƒ**
   - å·²å®‰è£…Java 8+å’ŒMaven 3.6+
   - å¯ä»¥SSHè¿æ¥åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨
   - å·²è·å–æœåŠ¡å™¨IPåœ°å€å’Œrootå¯†ç 

3. **ç½‘ç»œé…ç½®**
   - æœåŠ¡å™¨å¯ä»¥è®¿é—®äº’è”ç½‘ï¼ˆç”¨äºä¸‹è½½è½¯ä»¶åŒ…ï¼‰
   - æœ¬åœ°å¯ä»¥SSHè¿æ¥åˆ°æœåŠ¡å™¨

### éƒ¨ç½²æ­¥éª¤

#### æ–¹æ³•ä¸€ï¼šä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x deploy_to_aliyun.sh

# 2. è¿è¡Œéƒ¨ç½²è„šæœ¬
./deploy_to_aliyun.sh

# æˆ–è€…ç›´æ¥æŒ‡å®šæœåŠ¡å™¨IP
./deploy_to_aliyun.sh ä½ çš„æœåŠ¡å™¨IP
```

#### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²

1. **æœ¬åœ°æ‰“åŒ…é¡¹ç›®**
   ```bash
   mvn clean package -DskipTests
   ```

2. **ä¸Šä¼ åˆ°æœåŠ¡å™¨**
   ```bash
   scp -r ./* root@æœåŠ¡å™¨IP:/opt/sky-takeout/
   ```

3. **åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…ç¯å¢ƒ**
   ```bash
   ssh root@æœåŠ¡å™¨IP
   cd /opt/sky-takeout
   chmod +x quick_deploy.sh
   ./quick_deploy.sh
   ```

4. **é…ç½®æ•°æ®åº“**
   ```bash
   chmod +x deploy_database.sh
   ./deploy_database.sh
   ```

5. **å¯åŠ¨åº”ç”¨**
   ```bash
   systemctl start sky-takeout
   systemctl enable sky-takeout
   ```

### é…ç½®è¯´æ˜

#### æ•°æ®åº“é…ç½®
- **æ•°æ®åº“å**: `happy_tassie_travel`
- **ç”¨æˆ·å**: `skyapp`
- **é»˜è®¤å¯†ç **: `Sky2024@Strong!` (å»ºè®®ä¿®æ”¹)

#### åº”ç”¨é…ç½®
- **ç«¯å£**: 8080
- **ç¯å¢ƒ**: production
- **æ—¥å¿—è·¯å¾„**: `/opt/sky-takeout/logs/`

#### Redisé…ç½®
- **ç«¯å£**: 6379
- **æ•°æ®åº“**: 0

### é˜¿é‡Œäº‘å®‰å…¨ç»„é…ç½®

åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°é…ç½®å®‰å…¨ç»„è§„åˆ™ï¼š

1. ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
2. è¿›å…¥ECSç®¡ç†é¡µé¢
3. é€‰æ‹©ä½ çš„å®ä¾‹ï¼Œç‚¹å‡»"å®‰å…¨ç»„é…ç½®"
4. æ·»åŠ å…¥æ–¹å‘è§„åˆ™ï¼š
   - ç«¯å£èŒƒå›´: 8080/8080
   - åè®®ç±»å‹: TCP
   - æˆæƒå¯¹è±¡: 0.0.0.0/0
   - æè¿°: Sky Takeoutåº”ç”¨ç«¯å£

### éªŒè¯éƒ¨ç½²

éƒ¨ç½²å®Œæˆåï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ï¼š

1. **æ£€æŸ¥æœåŠ¡çŠ¶æ€**
   ```bash
   ssh root@æœåŠ¡å™¨IP 'systemctl status sky-takeout'
   ```

2. **æŸ¥çœ‹åº”ç”¨æ—¥å¿—**
   ```bash
   ssh root@æœåŠ¡å™¨IP 'journalctl -u sky-takeout -f'
   ```

3. **è®¿é—®åº”ç”¨**
   - åº”ç”¨é¦–é¡µ: `http://æœåŠ¡å™¨IP:8080`
   - APIæ–‡æ¡£: `http://æœåŠ¡å™¨IP:8080/doc.html`

4. **æµ‹è¯•æ•°æ®åº“è¿æ¥**
   ```bash
   ssh root@æœåŠ¡å™¨IP 'mysql -u skyapp -pSky2024@Strong! happy_tassie_travel -e "SHOW TABLES;"'
   ```

### å¸¸è§é—®é¢˜

#### 1. æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
journalctl -u sky-takeout --no-pager

# æ£€æŸ¥Javaç‰ˆæœ¬
java -version

# æ£€æŸ¥JARæ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /opt/sky-takeout/sky-take-out/sky-server/target/
```

#### 2. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
systemctl status mysqld

# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -u skyapp -p happy_tassie_travel

# æ£€æŸ¥æ•°æ®åº“ç”¨æˆ·æƒé™
mysql -u root -p -e "SELECT user, host FROM mysql.user WHERE user = 'skyapp';"
```

#### 3. ç«¯å£è®¿é—®é—®é¢˜
```bash
# æ£€æŸ¥åº”ç”¨æ˜¯å¦ç›‘å¬8080ç«¯å£
netstat -tlnp | grep 8080

# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
systemctl status firewalld
firewall-cmd --list-ports

# æ£€æŸ¥é˜¿é‡Œäº‘å®‰å…¨ç»„é…ç½®
```

#### 4. Redisè¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥RedisæœåŠ¡çŠ¶æ€
systemctl status redis

# æµ‹è¯•Redisè¿æ¥
redis-cli ping

# æ£€æŸ¥Redisé…ç½®
cat /etc/redis/redis.conf | grep bind
```

### è¿ç»´ç®¡ç†

#### å¯åŠ¨/åœæ­¢/é‡å¯æœåŠ¡
```bash
# å¯åŠ¨
systemctl start sky-takeout

# åœæ­¢
systemctl stop sky-takeout

# é‡å¯
systemctl restart sky-takeout

# æŸ¥çœ‹çŠ¶æ€
systemctl status sky-takeout
```

#### æŸ¥çœ‹æ—¥å¿—
```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
journalctl -u sky-takeout -f

# æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
journalctl -u sky-takeout -n 100

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—æ–‡ä»¶
tail -f /opt/sky-takeout/logs/sky-takeout.log
```

#### æ•°æ®åº“å¤‡ä»½
```bash
# æ‰‹åŠ¨å¤‡ä»½
/opt/scripts/backup_database.sh

# è®¾ç½®å®šæ—¶å¤‡ä»½ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹ï¼‰
crontab -e
# æ·»åŠ : 0 2 * * * /opt/scripts/backup_database.sh
```

#### æ›´æ–°åº”ç”¨
```bash
# 1. æœ¬åœ°é‡æ–°æ‰“åŒ…
mvn clean package -DskipTests

# 2. ä¸Šä¼ æ–°çš„JARæ–‡ä»¶
scp sky-server/target/sky-server-1.0-SNAPSHOT.jar root@æœåŠ¡å™¨IP:/opt/sky-takeout/sky-take-out/sky-server/target/

# 3. é‡å¯æœåŠ¡
ssh root@æœåŠ¡å™¨IP 'systemctl restart sky-takeout'
```

### å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†ç **
   - æ•°æ®åº“å¯†ç 
   - åº”ç”¨JWTå¯†é’¥

2. **é™åˆ¶æ•°æ®åº“è®¿é—®**
   ```sql
   -- åªå…è®¸æœ¬åœ°è®¿é—®MySQL
   DELETE FROM mysql.user WHERE user='skyapp' AND host='%';
   FLUSH PRIVILEGES;
   ```

3. **é…ç½®HTTPS**
   - ç”³è¯·SSLè¯ä¹¦
   - é…ç½®Nginxåå‘ä»£ç†

4. **å®šæœŸå¤‡ä»½**
   - è®¾ç½®è‡ªåŠ¨æ•°æ®åº“å¤‡ä»½
   - å¤‡ä»½åº”ç”¨é…ç½®æ–‡ä»¶

### è”ç³»æ”¯æŒ

å¦‚æœé‡åˆ°éƒ¨ç½²é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
- æœåŠ¡å™¨æ“ä½œç³»ç»Ÿç‰ˆæœ¬
- é”™è¯¯æ—¥å¿—å†…å®¹
- æœåŠ¡çŠ¶æ€ä¿¡æ¯
- ç½‘ç»œé…ç½®è¯¦æƒ…

---

**ç¥ä½ éƒ¨ç½²æˆåŠŸï¼ğŸ‰** 