# 🔐 环境变量配置说明

## ⚠️ 重要安全提醒

**你的阿里云密钥已经暴露在 Git 历史中，必须立即更换！**

1. 登录阿里云控制台：https://ram.console.aliyun.com/manage/ak
2. **禁用旧密钥**：`LTAI5tCtQxJjezN5ENbF3r2j`
3. **创建新密钥**并记录
4. 按照以下步骤配置新密钥

---

## 📋 本地开发环境配置

### Windows（本地开发）

#### 方法1：在 IDEA 中配置环境变量

1. 打开 IDEA，点击运行配置（Run → Edit Configurations）
2. 选择你的 Spring Boot 启动配置
3. 在 **Environment variables** 中添加：
   ```
   ALIYUN_OSS_ACCESS_KEY_ID=你的新AccessKeyId
   ALIYUN_OSS_ACCESS_KEY_SECRET=你的新AccessKeySecret
   ```

#### 方法2：系统环境变量

1. 右键"此电脑" → 属性 → 高级系统设置 → 环境变量
2. 在"用户变量"中新建：
   - 变量名：`ALIYUN_OSS_ACCESS_KEY_ID`
   - 变量值：你的新AccessKeyId
3. 再新建：
   - 变量名：`ALIYUN_OSS_ACCESS_KEY_SECRET`
   - 变量值：你的新AccessKeySecret
4. 重启 IDEA 生效

---

## 🖥️ 服务器生产环境配置

### Linux 服务器（Ubuntu）

#### 方法1：在 systemd 服务中配置（推荐）

编辑服务文件：
```bash
sudo nano /etc/systemd/system/happy-tassie-travel.service
```

在 `[Service]` 段添加环境变量：
```ini
[Service]
Environment="ALIYUN_OSS_ACCESS_KEY_ID=你的新AccessKeyId"
Environment="ALIYUN_OSS_ACCESS_KEY_SECRET=你的新AccessKeySecret"
Environment="SPRING_PROFILES_ACTIVE=prod"
```

重新加载并重启服务：
```bash
sudo systemctl daemon-reload
sudo systemctl restart happy-tassie-travel
sudo systemctl status happy-tassie-travel
```

#### 方法2：使用 .env 文件

1. 创建配置文件：
```bash
sudo mkdir -p /opt/happy-tassie-travel/config
sudo nano /opt/happy-tassie-travel/config/.env
```

2. 添加内容：
```bash
ALIYUN_OSS_ACCESS_KEY_ID=你的新AccessKeyId
ALIYUN_OSS_ACCESS_KEY_SECRET=你的新AccessKeySecret
```

3. 设置权限：
```bash
sudo chmod 600 /opt/happy-tassie-travel/config/.env
sudo chown root:root /opt/happy-tassie-travel/config/.env
```

4. 修改服务文件加载 .env：
```bash
sudo nano /etc/systemd/system/happy-tassie-travel.service
```

添加：
```ini
[Service]
EnvironmentFile=/opt/happy-tassie-travel/config/.env
```

---

## ✅ 验证配置

### 检查环境变量是否生效

**本地开发：**
```bash
# Windows PowerShell
echo $env:ALIYUN_OSS_ACCESS_KEY_ID

# Linux / Mac
echo $ALIYUN_OSS_ACCESS_KEY_ID
```

**服务器：**
```bash
# 查看服务环境变量
sudo systemctl show happy-tassie-travel --property=Environment

# 查看服务状态和日志
sudo systemctl status happy-tassie-travel
sudo journalctl -u happy-tassie-travel -n 50
```

---

## 🔒 安全最佳实践

### ✅ 应该做的：
- ✅ 使用环境变量存储密钥
- ✅ 定期轮换密钥（每3-6个月）
- ✅ 使用 `.gitignore` 排除敏感文件
- ✅ 为不同环境使用不同的密钥
- ✅ 限制密钥权限（只给必要的 OSS 权限）

### ❌ 不应该做的：
- ❌ 在代码中硬编码密钥
- ❌ 将密钥提交到 Git
- ❌ 在公共场合分享密钥
- ❌ 使用 root 账号的密钥
- ❌ 所有环境使用同一个密钥

---

## 📝 阿里云 RAM 子账号配置（推荐）

不要使用主账号的 AccessKey，应该创建 RAM 子账号：

1. 登录阿里云 RAM 控制台：https://ram.console.aliyun.com/
2. 创建 RAM 用户：
   - 用户名：`happy-tassie-app`
   - 访问方式：**仅编程访问**
3. 添加权限：
   - `AliyunOSSFullAccess`（或自定义更小的权限）
4. 保存生成的 AccessKey

---

## 🚨 密钥泄露应急处理

如果发现密钥泄露：

1. **立即禁用泄露的密钥**
2. **创建新密钥**
3. **更新所有使用该密钥的服务**
4. **检查账单是否有异常消费**
5. **如果是 RAM 子账号，删除并重建**

---

## 📞 联系方式

如有问题，请联系技术支持。

**最后更新：** 2025-10-22

